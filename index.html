<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wanz WA Connect Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<script src="wanzdev.js"></script>
<style>
  body {
    margin: 0;
    background: #010307;
    color: #c7fff1;
    font-family: 'Orbitron', monospace;
    overflow-x: hidden;
  }
  .wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    position: relative;
    text-align: center;
  }
  .lightning {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 20%, rgba(0,255,156,0.15), transparent 20%),
                radial-gradient(circle at 70% 80%, rgba(0,167,255,0.15), transparent 20%);
    filter: blur(60px);
    animation: flicker 3s infinite;
  }
  @keyframes flicker { 0%,100%{opacity:.05;} 50%{opacity:.2;} }

  .card {
    width: 90%;
    max-width: 700px;
    background: rgba(5,15,15,0.9);
    border: 1px solid rgba(0,255,156,0.2);
    border-radius: 14px;
    padding: 24px;
    box-shadow: 0 0 50px rgba(0,255,156,0.2);
    z-index: 2;
  }

  h1 {
    color: #00ff9c;
    text-shadow: 0 0 10px rgba(0,255,156,0.5);
    margin: 0 0 8px;
  }

  .muted { color: #7fb0a6; font-size: 13px; }
  label { display: block; margin-top: 10px; font-size: 13px; color: #7fb0a6; text-align: left; }
  input, textarea {
    width: 100%;
    padding: 10px;
    margin-top: 4px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
    background: transparent;
    color: #e6fff6;
    font-family: monospace;
  }
  textarea { min-height: 100px; resize: none; }

  .btn {
    display: inline-block;
    padding: 10px 16px;
    margin-top: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: transform 0.2s;
  }
  .btn-primary {
    background: linear-gradient(90deg,#00ff9c,#00a8ff);
    color: #021711;
    box-shadow: 0 0 20px rgba(0,255,156,0.3);
  }
  .btn-primary:hover { transform: scale(1.05); }
  .btn-ghost {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.2);
    color: #7fb0a6;
  }

  .pill {
    display: inline-block;
    margin-top: 12px;
    padding: 6px 14px;
    border-radius: 999px;
    background: rgba(0,255,156,0.08);
    font-weight: 700;
    color: #00ff9c;
  }

  .code {
    background: #001914;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 18px;
    letter-spacing: 3px;
    text-align: center;
    color: #00ff9c;
    border: 1px dashed #00ff9c;
  }

  .log {
    margin-top: 12px;
    background: rgba(255,255,255,0.05);
    padding: 10px;
    border-radius: 8px;
    font-size: 13px;
    min-height: 80px;
    overflow: auto;
    max-height: 200px;
    text-align: left;
  }
  
   /* === STYLE TAMBAHAN UNTUK KERAPIAN DAN RESPONSIF === */
  .divider {
    margin: 20px 0;
    border: none;
    border-top: 1px solid rgba(255,255,255,0.1);
  }
  .btn-group {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  input, textarea {
    transition: 0.2s ease;
  }
  input:focus, textarea:focus {
    outline: none;
    box-shadow: 0 0 10px rgba(0,255,156,0.3);
    border-color: #00ff9c;
  }
  @media (max-width: 600px) {
    .card {
      padding: 16px;
      width: 95%;
    }
    h1 {
      font-size: 20px;
    }
  }

  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .overlay.show { display: flex; }
  .modal {
    background: #041214;
    padding: 20px;
    border-radius: 12px;
    max-width: 420px;
    width: 90%;
    border: 1px solid rgba(0,255,156,0.3);
    box-shadow: 0 0 40px rgba(0,255,156,0.3);
  }
  .modal h3 { margin: 0; color: #00ff9c; }
</style>
</head>
<body>
<div class="wrap">
  <div class="lightning"></div>
  <div class="card">
    <h1>‚ö° XCVI SIMILARITY ‚ö°</h1>
    <p class="muted">
      Website Bug <code>Wanz Official</code><br>
      Port: <b id="portShow">-</b>
    </p>

    <!-- STATUS SERVER -->
    <div id="serverStatus" class="pill">Server: mengecek...</div>

    <!-- FORM SESSION -->
    <label for="nameInput">Nama Session</label>
    <input id="nameInput" type="text" placeholder="contoh: wanz">

    <label for="phoneInput">Nomor (format internasional tanpa +)</label>
    <input id="phoneInput" type="text" placeholder="628xxxxxx">

    <!-- BUTTON CONNECT -->
    <div class="btn-group">
      <button class="btn btn-primary" id="btnConnect">Connect</button>
      <button class="btn btn-ghost" id="btnDisconnect" style="display:none">Disconnect</button>
    </div>

    <!-- STATUS & KODE -->
    <div class="pill" id="statusPill">Status: idle</div>
    <div id="pairingCode" class="code">‚Äî</div>

    <hr class="divider">

    <!-- FORM KIRIM PESAN -->
    <label for="sendTo">Nomor Tujuan</label>
    <input id="sendTo" type="text" placeholder="628xxxxxx">

    <label for="sendText">Pesan</label>
    <textarea id="sendText" placeholder="Halo dari panel..."></textarea>

    <div class="btn-group">
      <button class="btn btn-primary" id="btnSend">Kirim Pesan</button>
      <button class="btn btn-ghost" id="btnSessions">Lihat Sessions</button>
    </div>

    <!-- LOG AREA -->
    <div class="log" id="logBox">[Log siap...]</div>
  </div>
</div>

<!-- MODAL -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h3 id="modalTitle">Info</h3>
    <div id="modalBody" style="margin-top:10px"></div>
    <div style="margin-top:10px;text-align:right">
      <button class="btn btn-primary" id="modalClose">Tutup</button>
    </div>
  </div>
</div>


 


<script>
const $ = s=>document.querySelector(s);

// === TAMPILKAN DOMAIN & PORT DARI wanzdev.js ===
$('#domainShow').textContent = WANZ_CONFIG.domain || '-';
$('#portShow').textContent = WANZ_CONFIG.port || '-';

async function updateServerStatus() {
  const pill = $('#serverStatus');
  const domain = WANZ_CONFIG.domain;
  const port = WANZ_CONFIG.port;

  if (!domain || !port) {
    pill.textContent = 'Server: tidak terhubung';
    pill.style.background = 'rgba(255,50,50,0.1)';
    pill.style.color = '#ff5050';
    return;
  }

  const url = `${domain}:${port}/`;

  // Bikin timeout manual biar ga ngegantung terus
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 3000);

  try {
    const res = await fetch(url, { signal: controller.signal });
    clearTimeout(timeout);

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    if (data?.success) {
      pill.textContent = 'Server: terhubung ‚úÖ';
      pill.style.background = 'rgba(0,255,156,0.1)';
      pill.style.color = '#00ff9c';
    } else {
      pill.textContent = 'Server: tidak merespon ‚ùå';
      pill.style.background = 'rgba(255,50,50,0.1)';
      pill.style.color = '#ff5050';
    }
  } catch (err) {
    clearTimeout(timeout);
    pill.textContent = 'Server: gagal dihubungi ‚ùå';
    pill.style.background = 'rgba(255,50,50,0.1)';
    pill.style.color = '#ff5050';
    console.warn('‚ö†Ô∏è Ping server gagal:', err.message);
  }
}
updateServerStatus();

// === LOGGING ===
function log(msg){
  const t = new Date().toLocaleTimeString();
  $('#logBox').innerHTML = `[${t}] ${msg}<br>` + $('#logBox').innerHTML;
}

// === MODAL ===
function showModal(title,body){
  $('#modalTitle').textContent=title;
  $('#modalBody').innerHTML=body;
  $('#overlay').classList.add('show');
}
$('#modalClose').onclick=()=>$('#overlay').classList.remove('show');

let connectedName = null;

// === CONNECT ===
$('#btnConnect').onclick = async () => {
  const name = $('#nameInput').value.trim();
  const phone = $('#phoneInput').value.trim();
  if (!name || !phone) return showModal('Error ‚ö†Ô∏è','Isi nama & nomor dulu.');

  log('Menghubungkan ke server...');
  try {
    const res = await Wanzdev.connect(name, phone);
    console.log('üì° [DEBUG connect response]', res);

    if (res && res.pairing_code) {
      connectedName = name;
      $('#statusPill').textContent = 'Status: Menunggu pairing...';
      $('#pairingCode').textContent = res.pairing_code;
      $('#btnConnect').style.display = 'none';
      $('#btnDisconnect').style.display = 'inline-block';
      showModal('Pairing Code', `<div class='code'>${res.pairing_code}</div>Gunakan kode ini di WhatsApp dalam 1 menit.`);
      log(`Pairing code (${name}): ${res.pairing_code}`);
    } else {
      const reason = res?.message || res?.detail || 'Koneksi gagal.';
      showModal('Gagal ‚ùå', `
        <b>Alasan:</b> ${reason}<br><br>
        <pre style="font-size:11px;background:#111;color:#0f0;padding:5px;border-radius:4px;">${JSON.stringify(res, null, 2)}</pre>
      `);
      log(`‚ùå Gagal connect: ${reason}`);
    }
  } catch (err) {
    console.error('üí• [CONNECT ERROR]', err);
    showModal('Kesalahan üå©Ô∏è', `
      Gagal menghubungi server.<br>
      <code>${err.message}</code>
    `);
    log(`Gagal connect ke server: ${err.message}`);
  }
};

// === DISCONNECT ===
$('#btnDisconnect').onclick = async () => {
  if (!connectedName) return showModal('Error','Belum ada session aktif.');
  log(`Memutuskan koneksi (${connectedName})...`);

  try {
    const res = await Wanzdev.disconnect(connectedName);
    console.log('üîå [DEBUG disconnect]', res);

    if (res && res.success) {
      log(`Session ${connectedName} dihapus.`);
      $('#statusPill').textContent = 'Status: idle';
      $('#pairingCode').textContent = '‚Äî';
      $('#btnDisconnect').style.display = 'none';
      $('#btnConnect').style.display = 'inline-block';
      connectedName = null;
      showModal('Berhasil ‚úÖ','Session dihapus permanen.');
    } else {
      showModal('Gagal ‚ùå', res?.message || 'Gagal menghapus session.');
      log(`‚ùå Gagal disconnect: ${res?.message}`);
    }
  } catch (err) {
    console.error('üí• [DISCONNECT ERROR]', err);
    showModal('Kesalahan üå©Ô∏è', `
      Gagal memutus koneksi.<br>
      Detail: <code>${err.message}</code>
    `);
  }
};

// === SEND MESSAGE ===
$('#btnSend').onclick = async () => {
  if (!connectedName) return showModal('Error','Connect dulu.');
  const to = $('#sendTo').value.trim();
  const text = $('#sendText').value.trim();
  if (!to || !text) return showModal('Error','Isi nomor & pesan.');

  log(`Mengirim pesan ke ${to}...`);
  try {
    const res = await Wanzdev.sendMessage(connectedName, to, text);
    console.log('‚úâÔ∏è [DEBUG sendMessage]', res);

    if (res && res.success) {
      log(`Pesan terkirim ke ${to}`);
      showModal('Terkirim ‚úÖ','Pesan berhasil dikirim.');
    } else {
      showModal('Gagal ‚ùå', res?.message || 'Gagal kirim pesan.');
      log(`‚ùå Gagal kirim pesan: ${res?.message}`);
    }
  } catch (err) {
    console.error('üí• [SEND ERROR]', err);
    showModal('Kesalahan üå©Ô∏è', `
      Tidak bisa kirim pesan.<br>
      Detail: <code>${err.message}</code>
    `);
  }
};

// === LIST SESSIONS ===
$('#btnSessions').onclick = async () => {
  try {
    const res = await Wanzdev.listSessions();
    console.log('üìã [DEBUG listSessions]', res);

    if (res && res.success) {
      const list = (res.sessions || []).map(s => `<li>${s}</li>`).join('') || '<i>Kosong</i>';
      showModal('Daftar Sessions', `<ul>${list}</ul>`);
      log('Daftar sessions dimuat.');
    } else {
      showModal('Error ‚ùå', res?.message || 'Gagal ambil sessions.');
      log('Gagal ambil daftar sessions.');
    }
  } catch (err) {
    console.error('üí• [LIST ERROR]', err);
    showModal('Kesalahan üå©Ô∏è', `
      Gagal ambil daftar sessions.<br>
      Detail: <code>${err.message}</code>
    `);
  }
};
</script>
</body>
</html>